<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MySpotify</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root{--spotify-green:#1ed760;--spotify-black:#121212;--spotify-dark:#181818;--spotify-gray:#282828;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body,html{background:#000;color:#fff;font-family:'Segoe UI',system-ui,sans-serif;overflow:hidden;height:100vh;}
        #app{display:flex;height:100vh;}

        /* 側欄 */
        nav{width:240px;background:var(--spotify-black);padding:20px 0;position:fixed;height:100%;overflow-y:auto;z-index:10;}
        .logo{padding:0 24px;margin-bottom:30px;}
        .logo img{height:40px;}
        .nav-item{display:flex;align-items:center;padding:12px 24px;color:#b3b3b3;font-size:14px;font-weight:700;cursor:pointer;transition:0.2s;}
        .nav-item:hover,.nav-item.active{color:#fff;background:rgba(255,255,255,0.1);}
        .nav-item span.material-icons-round{font-size:24px;margin-right:16px;}
        .create-playlist{margin-top:20px;padding:16px 24px;border-top:1px solid #282828;}
        .create-playlist button{background:rgba(255,255,255,0.1);border:none;color:#fff;padding:12px;border-radius:4px;width:100%;text-align:left;font-weight:700;}

        /* 主內容區 */
        main{margin-left:240px;flex:1;overflow-y:auto;background:linear-gradient(#1f1f1f,#121212);padding-bottom:90px;position:relative;}
        .top-bar{height:60px;background:rgba(0,0,0,0.7);backdrop-filter:blur(20px);position:sticky;top:0;z-index:9;display:flex;align-items:center;justify-content:space-between;padding:0 32px;}
        .search-box{background:#282828;border-radius:50px;padding:8px 16px;display:flex;align-items:center;gap:12px;width:364px;}
        .search-box input{background:transparent;border:none;outline:none;color:#fff;width:100%;font-size:14px;}

        section{padding:24px 32px;}
        h1{font-size:36px;font-weight:900;margin-bottom:24px;}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:24px;}
        .card{background:var(--spotify-gray);border-radius:8px;padding:16px;transition:0.2s;cursor:pointer;position:relative;overflow:hidden;}
        .card:hover{background:#333;}
        .card img{width:100%;aspect-ratio:1;border-radius:8px;margin-bottom:12px;}
        .card h3{font-size:14px;font-weight:700;margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
        .card p{font-size:12px;color:#b3b3b3;}
        .play-btn{position:absolute;bottom:70px;right:16px;background:var(--spotify-green);width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0;transition:0.3s;transform:translateY(10px);box-shadow:0 8px 20px rgba(0,0,0,0.6);}
        .card:hover .play-btn{opacity:1;transform:translateY(0);}

        /* 資料夾內頁 */
        .playlist-header{background:linear-gradient(135deg,#450af5,#8f5aff);padding:40px 32px;display:flex;align-items:flex-end;gap:32px;color:#fff;}
        .playlist-cover{width:232px;height:232px;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.6);}
        .playlist-info h1{font-size:72px;font-weight:900;}
        .playlist-info p{font-size:14px;margin-top:8px;}

        table{width:100%;border-collapse:collapse;margin-top:32px;}
        tr{border-bottom:1px solid rgba(255,255,255,0.1);transition:0.2s;}
        tr:hover{background:rgba(255,255,255,0.05);}
        td{padding:12px 0;vertical-align:middle;}
        .track-num{color:#b3b3b3;width:40px;text-align:center;}
        .track-title{font-weight:600;}
        .track-artist{color:#b3b3b3;font-size:14px;}
        .track-time{color:#b3b3b3;font-size:14px;text-align:right;padding-right:24px;}

        /* 播放器 */
        #player{position:fixed;bottom:0;left:0;right:0;height:90px;background:var(--spotify-black);border-top:1px solid #282828;display:flex;align-items:center;padding:0 16px;z-index:9999;}
        .player-left{display:flex;align-items:center;gap:16px;flex:1;}
        .player-center{flex:2;display:flex;flex-direction:column;align-items:center;gap:8px;}
        .player-right{flex:1;display:flex;justify-content:flex-end;gap:16px;}
        .progress-bar{width:100%;height:4px;background:#404040;border-radius:2px;overflow:hidden;cursor:pointer;}
        .progress-fill{height:100%;width:0%;background:var(--spotify-green);transition:width 0.1s;}

        .hidden{display:none !important;}
    </style>
</head>
<body>
<div id="app">
    <nav>
        <div class="logo"><h1 style="color:#1ed760;font-size:28px;font-weight:900;">MySpotify</h1></div>
        <div class="nav-item active" onclick="showHome()"><span class="material-icons-round">home</span>首頁</div>
        <div class="nav-item" onclick="document.getElementById('search').focus()"><span class="material-icons-round">search</span>搜尋</div>
        <div class="nav-item" onclick="showFolders()"><span class="material-icons-round">library_music</span>你的音樂庫</div>
        <div class="create-playlist">
            <button onclick="createFolder()">+ 建立播放清單</button>
        </div>
        <div id="folder-list"></div>
    </nav>

    <main id="main-content">
        <div class="top-bar">
            <div></div>
            <div class="search-box">
                <span class="material-icons-round">search</span>
                <input type="text" id="search" placeholder="搜尋歌曲、藝人或播放清單" oninput="liveSearch()">
            </div>
            <div></div>
        </div>

        <section id="home">
            <h1>全球熱門排行榜</h1>
            <div class="grid" id="top50"></div>
        </section>

        <section id="results" class="hidden">
            <h1>搜尋結果</h1>
            <div class="grid" id="search-results"></div>
        </section>

        <section id="folder-view" class="hidden"></section>
    </main>

    <div id="player">
        <div class="player-left">
            <img id="now-thumb" src="" width="56" height="56">
            <div>
                <div id="current-title">準備播放</div>
                <div style="color:#b3b3b3;font-size:12px;">點擊開始</div>
            </div>
        </div>
        <div class="player-center">
            <div style="display:flex;gap:32px;align-items:center;">
                <button onclick="toggleLoop()" id="loopBtn"><span class="material-icons-round">repeat</span></button>
                <button onclick="prevTrack()"><span class="material-icons-round">skip_previous</span></button>
                <button onclick="togglePlay()" style="font-size:48px;" id="playBtn"><span class="material-icons-round">play_arrow</span></button>
                <button onclick="nextTrack()"><span class="material-icons-round">skip_next</span></button>
            </div>
            <div class="progress-bar" onclick="seek(event)"><div class="progress-fill" id="progress"></div></div>
        </div>
        <div class="player-right">
            <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
        </div>
    </div>
</div>

<div id="youtube-player"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    const API_KEY = 'AIzaSyBpy0IZXf9kkkPh2FlO-UMTVXUSmNqqyTQ';
    let player, tracks = [], idx = -1, loop = false;
    let folders = JSON.parse(localStorage.getItem('myFolders')||'[]');
    let currentView = 'home';

    // 初始化
    onYouTubeIframeAPIReady = () => {
        player = new YT.Player('youtube-player', {playerVars:{playsinline:1,controls:0},events:{'onReady':()=>setInterval(updateProgress,500),'onStateChange':e=>{
            document.querySelector('#playBtn span').textContent = e.data===1?'pause':'play_arrow';
            if(e.data===0) loop?playCurrent():nextTrack();
        }}});
        loadTop50();
        renderFolders();
    };

    // 極速搜尋 + 排行榜
    async function liveSearch(){ /* 留給你貼入快速搜尋邏輯 */ }
    async function loadTop50(){
        const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&videoCategoryId=10&regionCode=TW&maxResults=50&key=${API_KEY}`);
        const data = await res.json();
        const container = document.getElementById('top50');
        container.innerHTML = '';
        data.items.forEach((v,i)=>{
            const div = document.createElement('div');
            div.className='card';
            div.innerHTML = `
                <img src="${v.snippet.thumbnails.medium.url}">
                <h3>${v.snippet.title}</h3>
                <p>${v.snippet.channelTitle}</p>
                <div class="play-btn" onclick="playSong('${v.id}','${v.snippet.title.replace(/'/g,"\\'")}','${v.snippet.thumbnails.medium.url}')">
                    <span class="material-icons-round">play_arrow</span>
                </div>
            `;
            container.appendChild(div);
        });
    }

    // 播放核心（保持不變）
    function playSong(id,title,thumb){ tracks=[{id,title,thumb}]; idx=0; playCurrent(); }
    function playCurrent(){ /* 同上版 */ }
    function nextTrack(){ idx=(idx+1)%tracks.length; playCurrent(); }
    function prevTrack(){ idx=idx<=0?tracks.length-1:idx-1; playCurrent(); }
    function togglePlay(){ player.getPlayerState()===1?player.pauseVideo():player.playVideo(); }
    function toggleLoop(){ loop=!loop; document.getElementById('loopBtn').classList.toggle('active',loop); }

    // 資料夾系統（完整可編輯）
    function createFolder(){
        const name = prompt('播放清單名稱');
        if(name) { folders.push({name,songs:[]}); saveAndRender(); }
    }
    function renderFolders(){
        const list = document.getElementById('folder-list');
        list.innerHTML = folders.map((f,i)=>`
            <div class="nav-item" onclick="openFolder(${i})">
                <span class="material-icons-round">folder_special</span>${f.name} <small>(${f.songs.length})</small>
            </div>
        `).join('');
    }
    function openFolder(i){
        const f = folders[i];
        document.getElementById('folder-view').classList.remove('hidden');
        document.getElementById('folder-view').innerHTML = `
            <div class="playlist-header">
                <img class="playlist-cover" src="${f.songs[0]?.thumb||'https://i.imgur.com/8z6Q7vJ.png'}">
                <div class="playlist-info">
                    <p>播放清單</p>
                    <h1>${f.name}</h1>
                    <p>${f.songs.length} 首歌曲</p>
                </div>
            </div>
            <table>
                ${f.songs.map((s,j)=>`
                <tr onclick="playSong('${s.id}','${s.title}','${s.thumb}');tracks=${JSON.stringify(f.songs)};idx=${j}">
                    <td class="track-num">${j+1}</td>
                    <td><div class="track-title">${s.title}</div><div class="track-artist">Unknown</div></td>
                    <td class="track-time"><span class="material-icons-round" onclick="event.stopPropagation();removeFromFolder(${i},${j})">delete</span></td>
                </tr>`).join('')}
            </table>
        `;
        document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));
        document.getElementById('folder-view').classList.remove('hidden');
    }
    function removeFromFolder(fi,si){
        if(confirm('確定刪除這首歌？')){ folders[fi].songs.splice(si,1); saveAndRender(); openFolder(fi); }
    }
    function saveAndRender(){ localStorage.setItem('myFolders',JSON.stringify(folders)); renderFolders(); }

    function showHome(){ location.reload(); }
    function showFolders(){ /* 顯示側欄即可 */ }

    // 啟動
    if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
</script>
</body>
</html>