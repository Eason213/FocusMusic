<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>FocusMusic</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#000;color:#fff;font-family:system-ui;height:100vh;display:flex;flex-direction:column;overflow:hidden;}
header{height:70px;background:#000;display:flex;align-items:center;padding:0 12px;gap:10px;}
header h1{color:#1ed760;font-size:26px;font-weight:900;}
#search{flex:1;background:#222;color:#fff;padding:12px 16px;border-radius:30px;font-size:16px;outline:none;border:none;}
#refresh{background:#333;color:#fff;padding:8px 14px;border-radius:20px;font-size:14px;cursor:pointer;}
main{flex:1;overflow-y:auto;padding:20px 16px 110px;background:#000;}
h1{font-size:30px;font-weight:900;margin-bottom:20px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:20px;}
.card{background:#1a1a1a;border-radius:12px;overflow:hidden;position:relative;cursor:pointer;transition:.25s;}
.card:hover{transform:scale(1.06);}
.card img{width:100%;aspect-ratio:1;object-fit:cover;border-radius:8px;}
.card h3{padding:12px;font-size:14px;line-height:1.4;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
.play{position:absolute;right:16px;bottom:70px;width:60px;height:60px;background:#1ed760;color:#000;border-radius:50%;
    display:flex;align-items:center;justify-content:center;opacity:0;transition:.3s;font-size:34px;box-shadow:0 8px 25px rgba(0,0,0,0.7);}
.card:hover .play{opacity:1;}
#player{position:fixed;bottom:0;left:0;right:0;height:90px;background:#000;border-top:1px solid #333;
    display:flex;align-items:center;padding:0 20px;z-index:999;gap:16px;}
#player img{width:56px;height:56px;border-radius:8px;}
#nowTitle{flex:1;font-weight:600;font-size:16px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.controls{display:flex;align-items:center;gap:20px;}
.controls button{background:transparent;color:#aaa;width:50px;height:50px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:32px;}
#playBtn{background:#1ed760;color:#fff;width:64px;height:64px;border-radius:50%;font-size:38px!important;box-shadow:0 8px 25px rgba(30,215,96,0.5);}
#loopBtn{color:#1ed760;}
.progress{position:absolute;bottom:0;left:0;right:0;height:4px;background:#333;cursor:pointer;}
#bar{height:100%;width:0%;background:#1ed760;transition:width .1s linear;}
.time{position:absolute;bottom:10px;left:20px;right:20px;display:flex;justify-content:space-between;color:#aaa;font-size:12px;}
#shuffle{position:fixed;bottom:106px;left:50%;transform:translateX(-50%);background:#1ed760;color:#000;
    padding:16px 40px;border-radius:50px;font-size:18px;font-weight:900;cursor:pointer;z-index:99;}
</style>
</head>
<body>

<header>
    <h1>FocusMusic</h1>
    <input type="text" id="search" placeholder="搜尋歌曲…" onkeydown="if(event.key==='Enter')doSearch()">
    <div id="refresh" onclick="location.reload()">刷新</div>
</header>

<main>
    <h1>熱門華語（免 API Key）</h1>
    <div class="grid" id="grid"></div>
</main>

<div id="shuffle" onclick="shufflePlay()">隨機播放全部</div>

<div id="player">
    <img id="thumb" src="https://i.imgur.com/8z6Q7vJ.png">
    <div id="nowTitle">準備播放</div>
    <div class="controls">
        <button onclick="toggleLoop()" id="loopBtn"><span class="material-icons-outlined">repeat</span></button>
        <button onclick="prev()"><span class="material-icons-outlined">skip_previous</span></button>
        <button id="playBtn" onclick="togglePlay()"><span class="material-icons-outlined">play_arrow</span></button>
        <button onclick="next()"><span class="material-icons-outlined">skip_next</span></button>
        <button onclick="shufflePlay()"><span class="material-icons-outlined">shuffle</span></button>
    </div>
    <div class="progress" onclick="seek(event)"><div id="bar"></div></div>
    <div class="time">
        <span id="currentTime">0:00</span>
        <span id="totalTime">0:00</span>
    </div>
</div>

<div id="yt" style="display:none;"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
// 完全免 API Key！直接用公開播放清單（永遠有歌）
const playlistIds = [
    "PLFgquLnL59alCl_2TQvOiD5Vgm1hCaGSI", // 周杰倫
    "PL4fGSI1pDJn6jXS_Tv_N9B8Z0HTRVJE0m", // 華語金曲
    "PLw-VjHDl-ZG0nPR3M6l8cG3s6p7k5cBwX"  // 抖音熱歌
];

let player, songs = [], current = -1;
let loopMode = 0; // 0=列表, 1=單曲, 2=隨機

// 隨機選一個播放清單
fetch(`https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fwww.youtube.com%2Ffeeds%2Fvideos.xml%3Fplaylist_id%3D${playlistIds[Math.floor(Math.random()*playlistIds.length)]}`)
    .then(r=>r.json())
    .then(d=>{
        songs = d.items.map(x=>({
            id: x.guid.split('=')[1],
            title: x.title,
            thumb: x.thumbnail
        }));
        render();
    });

function render(){
    const g=document.getElementById('grid');
    g.innerHTML='';
    songs.forEach((s,i)=>{
        const d=document.createElement('div');
        d.className='card';
        d.innerHTML=`
            <img src="${s.thumb}">
            <h3>${s.title}</h3>
            <div class="play" onclick="event.stopPropagation();play(${i})">
                <span class="material-icons-outlined">play_arrow</span>
            </div>`;
        d.onclick=()=>play(i);
        g.appendChild(d);
    });
}

function onYouTubeIframeAPIReady(){
    player=new YT.Player('yt',{
        playerVars:{autoplay:1,controls:0,playsinline:1,rel:0},
        events:{
            'onReady':()=>{setInterval(updateTime,500);play(0);},
            'onStateChange':e=>{
                document.querySelector('#playBtn span').textContent=e.data===1?'pause':'play_arrow';
                if(e.data===0){
                    if(loopMode===1)play(current);
                    else if(loopMode===2)shufflePlay();
                    else next();
                }
            }
        }
    });
}

function play(i){
    current=i;
    const s=songs[i];
    document.getElementById('nowTitle').textContent=s.title;
    document.getElementById('thumb').src=s.thumb;
    player.loadVideoById(s.id);
}
function togglePlay(){player.getPlayerState()===1?player.pauseVideo():player.playVideo();}
function next(){play(current>=songs.length-1?0:current+1);}
function prev(){play(current<=0?songs.length-1:current-1);}
function seek(e){
    const rect=e.currentTarget.getBoundingClientRect();
    player.seekTo((e.clientX-rect.left)/rect.width*player.getDuration());
}
function updateTime(){
    if(!player?.getDuration)return;
    const c=player.getCurrentTime()||0;
    const d=player.getDuration()||0;
    document.getElementById('bar').style.width=(c/d*100)+'%';
    document.getElementById('currentTime').textContent=fmt(c);
    document.getElementById('totalTime').textContent=fmt(d);
}
function fmt(t){const m=Math.floor(t/60);const s=Math.floor(t%60);return m+':'+(s<10?'0':'')+s;}
function shufflePlay(){
    const a=[...songs];
    for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
    }
    songs=a;render();play(0);
}
function toggleLoop(){
    loopMode=(loopMode+1)%3;
    const icons=['repeat','repeat_one','shuffle'];
    document.querySelector('#loopBtn span').textContent=icons[loopMode];
}
function doSearch(){
    const q=document.getElementById('search').value.trim();
    if(q)window.open(`https://m.youtube.com/results?search_query=${encodeURIComponent(q)}`,'_blank');
}
</script>
</body>
</html>